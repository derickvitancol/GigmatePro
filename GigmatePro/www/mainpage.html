<!DOCTYPE html>
<html>

<head>

    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <title>Gigmates</title>
    <script type="text/javascript" src="cordova.js"></script>
    <!--<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>-->
    <!--<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
    <!--<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>-->
    <!--<script type="text/javascript" src="http://tarruda.github.com/bootstrap-datetimepicker/assets/js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="http://tarruda.github.com/bootstrap-datetimepicker/assets/js/bootstrap-datetimepicker.pt-BR.js"></script>-->

    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="css/homepage.css" />
    <link rel="stylesheet" type="text/css" href="css/items.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600&family=Raleway:wght@600&display=swap" rel="stylesheet">

</head>
<body style="background-color: rgb(100, 100, 128);" onload="mainloadingFunctions()">
    <!--Search-->
    <div class="search" id="searchBox">
        <form class="search-form">
            <input type="text" placeholder="Search for Gigs..">
            <p class="float-right"><a href="#" class="btn-block" role="button" id="loadSModal">Search</a></p>
        </form>
    </div>



    <div data-role="page" id="MainPage">

        <div role="main" class="ui-content">
            <div id="wrapper">
                <!--Search-->
                <!--<div class="search" id="searchBox">
                    <form class="search-form">
                        <input type="text" placeholder="Search for Gigs..">
                        <input type="submit" value="Search">
                    </form>
                </div>-->
                <!--TOP NAV-->
                <div class="topnav" id="myTopnav">
                    <ul class="actions" id="main-menu">

                        <li>
                            <a href="#MainPage" class="active">Upcoming Gigs</a>
                        </li>
                        <li>
                            <a href="#Gigs">Gig Mates</a>
                        </li>
                    </ul>
                </div>
                <br />


                <div id="page-wrapper">
                    <div id="page-inner">

                        <div class="grid-container">
                            <div class="col-sm-6 col-md-4">
                                <div class="thumbnail">
                                    <center>
                                        <img src="images/logo.png" alt="" width="184" height="29">
                                    </center>
                                    <div class="caption" id="GigsContainer">
                                        <div>
                                            <!--<center>
                                                <label class="names">Name of Gig</label>
                                            </center>


                                            <br />
                                            <label class="capt">Venue</label>
                                            <br />
                                            <label class="capt">Schedule</label>
                                            <br />-->
                                            <!--<center>
                                                <p><a href="#" class="btn btn-primary" role="button" id="jGigBtn">Join</a></p>
                                            </center>-->
                                        </div>

                                    </div>


                                </div>
                            </div>
                        </div>

                        <!--Create Gig-->
                        <div>
                            <br>
                            <center>
                                <button class="btn btn-primary" id="cGigBtn">Create Gig</button>
                            </center>
                        </div>
                        <div class="bg-modal" style="display:none">
                            <div class="modal-cont">
                                <center>
                                    <div class="close" id="cls1">x</div>
                                    <br />
                                    <h2>CREATE GIG</h2>
                                    <input type="text" class="row form-control" placeholder="Name of Gig" id="nameBox">
                                    <br />
                                    <select type="text" class="row form-control" placeholder="Genre" id="GigGenreBox"></select>
                                    <br />
                                    <input type="text" class="row form-control" placeholder="Venue" id="venueBox">
                                    <br />
                                    <label for="sched">Schedule:</label>
                                    <br />
                                    <label for="dateBox">Date</label>
                                    <input type="date" id="dateBox">
                                    <label>TIME: </label>
                                    <input type="time" id="timeBox" placeholder="Time" />

                                    <br />
                                    <br />

                                    <button class="btn btn-primary" role="button" onclick="CreateGigClicked()">Create</button>
                                </center>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
            </div>
        </div>
    </div>



    <div data-role="page" id="Gigs" style="display:none">
        <div role="main" class="ui-content">
            <div id="wrapper">
                <!--Search-->
                <!--<div class="search" id="searchBox">
                    <form class="search-form">
                        <input type="text" placeholder="Search for Gigs..">
                        <input type="submit" value="Search">
                    </form>
                </div>-->
                <!--TOP NAV-->
                <div class="topnav" id="myTopnav">
                    <ul class="actions" id="main-menu">

                        <li>
                            <a href="mainpage.html">Upcoming Gigs</a>
                        </li>
                        <li>
                            <a href="#Gigs" class="active">Gig Mates</a>
                        </li>
                    </ul>
                </div>
                <br />

                <div id="page-wrapper">
                    <div id="page-inner">

                        <div class="grid-container">
                            <div class="col-sm-6 col-md-4">
                                <div class="thumbnail">
                                    <div class="caption">
                                        <center>
                                            <label class="names">Name of Gig Mate</label>
                                            <br />
                                            <label class="capt">@username</label>
                                            <br />
                                            <label class="capt">Type</label>
                                        </center>
                                        <br />
                                        <label class="capt">Age</label>
                                        <br />
                                        <label class="capt">Gender</label>
                                        <br />
                                        <label class="capt">Location</label>
                                        <br />
                                        <label class="capt">Bio</label>
                                        <center>
                                            <p><a href="#" class="btn btn-primary" role="button">Invite</a></p>
                                        </center>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /. PAGE INNER  -->

                    </div>
                    <!-- /. PAGE WRAPPER  -->

                </div>

            </div>
        </div>
    </div>

    <!--MODAL OF SEARCH-->
    <div class="bg-modal-reg" style="display:none">
        <div class="modal-cont">

            <center>
                <div class="close" id="cls">x</div>
                <br />
                <h2>SEARCH RESULTS</h2>

                <div class="grid-container">
                    <div class="col-sm-6 col-md-6">
                        <div class="thumbnail">
                            <div class="caption">
                                <label class="names">Searched Result</label>
                                <br />
                                <label class="capt">Description</label>
                                <br />
                                <ul class="button">
                                    <center>
                                        <li><a href="#" class="btn btn-primary" role="button">Join?</a></li>
                                    </center>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid-container">
                    <div class="col-sm-6 col-md-6">
                        <div class="thumbnail">
                            <div class="caption">
                                <label class="names">Searched Result 2</label>
                                <br />
                                <label class="capt">Description</label>
                                <br />
                                <ul class="button">
                                    <center>
                                        <li><a href="#" class="btn btn-primary" role="button">Invite?</a></li>
                                    </center>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </center>


        </div>
    </div>

    <!--BOTTOM NAV-->
    <nav class="navbar fixed-bottom navbar-dark bg-dark" id="Main">
        <div class="navbar-nav">
            <ul class="actions" id="main-menu">
                <li>
                    <a class="nav-item nav-link active" href="mainpage.html">Home<span class="sr-only">(current)</span></a>
                </li>
                <li>
                    <a class="nav-item nav-link" href="notif.html">Notifications</a>
                </li>
                <li>
                    <a class="nav-item nav-link" href="prof.html">Profile</a>
                </li>
            </ul>
        </div>
    </nav>

    <style>

        .vertical-menu {
            width: 500px;
        }

            .vertical-menu a {
                background-color: transparent;
                color: white;
                display: block;
                padding: 12px;
                text-decoration: none;
            }

                .vertical-menu a:hover {
                    background-color: #ccc;
                }

                .vertical-menu a.active {
                    color: lightblue;
                }

        .search {
            border: 2px solid #3b1fa0;
            overflow: auto;
            border-radius: 5px;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
        }

            .search input[type="text"] {
                border: 0px;
                width: 67%;
                padding: 10px 10px;
            }

                .search input[type="text"]:focus {
                    outline: 0;
                }

            .search a[id=loadSModal] {
                border: 0px;
                background: none;
                background-color: #4932c9;
                color: #fff;
                float: right;
                padding: 10px;
                border-radius-top-right: 5px;
                -moz-border-radius-top-right: 5px;
                -webkit-border-radius-top-right: 5px;
                border-radius-bottom-right: 5px;
                -moz-border-radius-bottom-right: 5px;
                -webkit-border-radius-bottom-right: 5px;
                cursor: pointer;
                border-radius: 0px;
            }

            .search p[class=float-right] {
                margin-bottom: 0;
            }


        /* ===========================
        ====== Medua Query for Search Box ======
        =========================== */

        @media only screen and (min-width : 150px) and (max-width : 780px) {

        {
        }

        .search {
            width: 95%;
            margin: 0 auto;
        }

        }

        .grid-container {
            display: grid;
            grid-gap: 10px;
            background-color: #36498f;
            opacity: 0.9;
            padding: 15px;
            height: auto;
        }

        .grid-item {
            background-color: rgba(255, 255, 255, 0.8);
            text-align: center;
            padding: 20px;
            font-size: 30px;
        }

        .item1 {
            grid-column: 1;
            grid-row: 1;
        }

        .item2 {
            grid-column: 2 / span 3;
            grid-row: 1;
        }
    </style>
    <script type="text/javascript" src="scripts/jQuery/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="scripts/popper.min.js"></script>
    <script type="text/javascript" src="scripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="scripts/bootstrap.js"></script>
    <script type="text/javascript" src="scripts/functions.js"></script>



    <script>
        //FUNCTION CALLED ON MAINPAGE ONLOAD
        function mainloadingFunctions() {
            getUserData();
            getGenres(document.getElementById("GigGenreBox"));
            GetAvailableGigs();

        }


        $('a[href="#Gigs"]').click(function () {
            $('.navbar-toggle:visible').click();
            $("#MainPage").hide();
            $("#Gigs").show();
        });


        $(document).ready(function () {
            document.getElementById('loadSModal').addEventListener('click', function () {
                document.querySelector('.bg-modal-reg').style.display = 'flex';
            });

            document.getElementById('cls').addEventListener('click', function () {
                document.querySelector('.bg-modal-reg').style.display = 'none';
            });
        });

        $(document).ready(function () {
            document.getElementById('cGigBtn').addEventListener('click', function () {
                document.querySelector('.bg-modal').style.display = 'flex';
            });

            document.getElementById('cls1').addEventListener('click', function () {
                document.querySelector('.bg-modal').style.display = 'none';
            });
        });



        function CreateGigClicked() {

            if (!document.getElementById("nameBox").value) {
                alert("Gig Name cannot be empty!");
            }
            else if (!document.getElementById("venueBox").value) {
                alert("Gig Venue cannot be empty!");
            }
            else if (!document.getElementById("dateBox").value && !document.getElementById("timeBox").value) {
                alert("date is not valid");
            }
            else {

                var userDetails = JSON.parse(window.localStorage.getItem("userDetails"));
                var gigName = document.getElementById("nameBox").value;
                var gigVenue = document.getElementById("venueBox").value;
                var gigGenre = document.getElementById("GigGenreBox").value;
                var gigDate = document.getElementById("dateBox").value + " " + document.getElementById("timeBox").value + ":00";
                var gigCreator = userDetails.ID;
                var gigJSON = {
                    "newGig": {
                        Name: gigName,
                        Date: gigDate,
                        Creator: gigCreator,
                        Venue: gigVenue,
                        GenreID: gigGenre
                    }
                }
                var xhr = $.ajax(
                    {
                        type: "POST",
                        url: "http://localhost/GigmatesService/Service1.svc/AddGig",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: JSON.stringify(gigJSON)

                    }).done(function (data) {
                        alert("Number of gigs created: " + data.AddGigResult);
                        document.getElementById("nameBox").value = "";
                        gigVenue = document.getElementById("venueBox").value = "";
                    }).fail(function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(XMLHttpRequest.status + ' ' + textStatus + ' ' + errorThrown.message);
                    });
            }
        }


        function GetAvailableGigs() {
            var userDetails = JSON.parse(window.localStorage.getItem("userDetails"));
            var userJSON = { "userID": userDetails.ID };
            var WCFCall = $.ajax(
                {
                    type: "POST",
                    url: "http://localhost/GigmatesService/Service1.svc/GetAvailableGigs",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(userJSON)

                }).done(function (data) {
                    var containerDiv = document.getElementById("GigsContainer");
                    window.localStorage.setItem("AvailableGigs", data.GetAvailableGigsResult);
                    var AvailableGigJSON = JSON.parse(data.GetAvailableGigsResult);

                    //FUNCTION THAT DISPLAYS EACH GIG
                    for (var i = 0; i < Object.keys(AvailableGigJSON).length; i++) {
                        var divParent = document.createElement("div");
                        var centerCon = document.createElement("center");
                        divParent.classList = "caption";
                        var nameCon = document.createElement("label");
                        nameCon.classList = "capt";
                        nameCon.innerHTML = AvailableGigJSON[i].Name;

                        var venueCon = document.createElement("label");
                        venueCon.innerHTML = "Venue: " + AvailableGigJSON[i].Venue;
                        venueCon.classList = "capt";
                        var scheduleCon = document.createElement("label");
                        scheduleCon.innerHTML = "Date And Time: " + AvailableGigJSON[i].Date;
                        scheduleCon.classList = "capt";
                        var genreCon = document.createElement("label");
                        genreCon.innerHTML = "Genre: " + AvailableGigJSON[i].GenreName;
                        genreCon.classList = "capt";

                        var brElem2 = document.createElement("br");
                        var creatorNameCon = document.createElement("label");
                        creatorNameCon.innerHTML = "Creator Name: " + AvailableGigJSON[i].CreatorName;
                        creatorNameCon.classList = "capt";
                        var idCon = document.createElement("div");
                        idCon.id = "gigID";
                        idCon.innerHTML = AvailableGigJSON[i].GigID;
                        idCon.classList = "d-none";
                        var brElem = document.createElement("br");

                        var creatorIDCon = document.createElement("div");
                        creatorIDCon.id = "creatorID";
                        creatorIDCon.innerHTML = AvailableGigJSON[i].Creator;
                        creatorIDCon.classList = "d-none";

                        var buttonCenter = document.createElement("center");

                        var joinGigButton = document.createElement("button");
                        joinGigButton.classList = "btn btn-primary";
                        joinGigButton.type = "button";
                        joinGigButton.innerHTML = "Join Gig";

                        $(joinGigButton).click(function () {
                            var userDetails = JSON.parse(window.localStorage.getItem("userDetails"));
                            var gigID = $(joinGigButton).parent().siblings("#gigID").html();
                            var receiverID = $(joinGigButton).parent().siblings("#creatorID").html();
                            SendGigRequest(gigID, userDetails.ID, receiverID);
                            //MAKE REFRESH THEN RECALL AVAILABLE GIGS WITH THE REMOVED GIG REQUEST UPDATE DATABASE STORED PROC
                        });

                        centerCon.appendChild(nameCon);
                        divParent.appendChild(centerCon);
                        divParent.appendChild(venueCon);
                        divParent.appendChild(scheduleCon);
                        divParent.appendChild(genreCon);
                        divParent.appendChild(brElem2);
                        divParent.appendChild(creatorNameCon);
                        divParent.appendChild(brElem);
                        buttonCenter.appendChild(joinGigButton);
                        divParent.appendChild(buttonCenter);
                        divParent.appendChild(idCon);
                        divParent.appendChild(creatorIDCon);
                        containerDiv.appendChild(divParent);

                    }
                }).fail(function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.status + ' ' + textStatus + ' ' + errorThrown.message);
                });
        }

        function SendGigRequest(gigID, senderID, receiverID) {
            var inviteType = 1;
            var InviteStatus = 2;

            var inviteJSON = {
                "NewInvite": {
                    ReceiverID: receiverID,
                    SenderID: senderID,
                    StatusID: InviteStatus,
                    TypeID: inviteType,
                    PurposeID: gigID
                }
            };
            var WCFCall = $.ajax(
                {
                    type: "POST",
                    url: "http://localhost/GigmatesService/Service1.svc/SendGigInvite",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    data: JSON.stringify(inviteJSON)
                }).done(function (data) {
                    alert("Number of Invites Sent: " + data.SendGigInviteResult);
                }).fail(function (XMLHttpRequest, textStatus, errorThrown) {
                    alert(XMLHttpRequest.status + ' ' + textStatus + ' ' + errorThrown.message);
                });
        }
    </script>
</body>
</html>
